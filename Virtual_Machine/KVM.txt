Content-Type: text/x-zim-wiki
Wiki-Format: zim 0.4

====== KVM ======

$ grep -E '(vmx|svm)'   /proc/cpuinfo
$ cat /boot/config... | grep KVM
$ sudo apt-get install kvm libvirt-bin ubuntu-vm-builder  bridge-utils kvm-pxe uml-utilities 
$ sudo lsmod | grep kvm

$ sudo /etc/init.d/networking stop
$ sudo vim /etc/network/interfaces

auto br0
iface br0 inet dhcp
bridge_ports eth0
bridge_stp off
bridge_fd 5
bridge_maxwait 5


auto br0
iface br0 inet static
address 192.168.0.xxx
network 192.168.0.0
netmask 255.255.255.0
broadcast 192.168.0.255
gateway 192.168.0.1
bridge_ports eth0
bridge_stp off
bridge_fd 5
bridge_maxwait 5


$ virsh -c qemu:///system list

$ dd if=/dev/zero of=ubuntu1604.server.img bs=1M count=8192
$ qemu-system-x86_64 --enable-kvm -m 2048 -smp 4 -boot order=cd -hda /home/houbinyi/kvm/ubuntu.1604.server.img -cdrom /mnt/hgfs/share/ubuntu-16.04-server-amd64.iso
$ qemu -m 2048 -smp 4 -hda [[~/kvm/ubuntu.1604.server.img]]
$ qemu -cpu ?

-smp n[,maxcpus=cpus][,cores=cores][,threads=threads][,sockets=sockets]
-cpu cpu_model
-m megs
-mem-path FILE
-mem-prealloc
-daemonize
-vnc :n
-hda file
-hdb file
-hdc file
-hdd file
-fda file
-fdb file
-cdrom file
mtdblock file
-sd file
-pflash file
-drive file=file,if=[ide,scsi,sd,mtd,floopy,pflash,virtio],bus=bus,unit=unit,index=index,media=[disk,cdrom],snapshot=[on,off],cache =[none,writeback,writethrough],aio=[threads,native],format=format,serial=serial,addr=addr,id-name,readonly=[on,off]
-boot [roder=drives][,once=drives][,menu=on|off][,splash=splashfile][,splash-time=sp-time]

$ qemu -m 1024 -smp 2 some.img
$ qemu -m 1024 -smp 2 -hda some.img
$ qemu -m 1024 -smp 2 -driver file=some.img,if=ide,cache=writethrough

qeum-img 
check [-f fmt] filename
create [-f fmt] [-o options] filename [size]
commit [-f fmt] filename
convert [-c] [-f fmt][-O output_fmt][-o options] filename [filename2 [...]] output_filename
info [-f fmt] filename
snapshot [-l|a sanpshot | -c snapshot | -d snapshot] filename
rebase [-f fmt] [-t cache] [-p] [-u] -b backing_file [-F backing_fmt] filename
resize filename [+|-] size

fmt : raw host_device gcow2 qcow cow vdi vmdk vpc sheepdog

qemu -net nic,model=?
-net nic[,vlan=n][,macaddr=mac][,model=type][,name=name][,addr=addr][,vectros=v]

-net tap[,vlan=0][,name=str][,fd=h][,ifname=name][,script=file][,downscript=dfile][,helper=helper][,sndfub=nbytes][,vent_hdr=on|off][,vhost=on|off][,vhostfd=h][,vhostforce=on|off]






